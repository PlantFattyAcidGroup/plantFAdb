<% content_for :top_bar do %>
	<h1 class="pagetitle">Fatty Acids</h1>
	<span class='small'>Structures drawn at OPSIN (opsin.ch.cam.uk)</span>
	<% unless params[:name_query].blank? %>
		<p>Filtering on Name: <b><%= params[:name_query] %></b></p>
	<% end %>
	<% unless params[:delta_notation_query].blank? %>
		<p>Filtering on Delta Notation: <b><%= params[:delta_notation_query] %></b></p>
	<% end %>
	<% unless params[:mass_min].blank? %>
		<p>Filtering mass less than: <b><%= params[:mass_min] %></b></p>
	<% end %>
	<% unless params[:mass_max].blank? %>
		<p>Filtering mass greather than: <b><%= params[:mass_max] %></b></p>
	<% end %>
<% end %>

<% content_for :item_bar do %>
	<%= link_to 'Download', params.merge(format: 'csv'), class: 'btn btn-primary'%>
<% end %>


<%= render partial: 'shared/page_and_search', locals: {items: @fatty_acids, show_advanced: true} %>
<div id='advanced_search' class='well form-horizontal' style='display:none;width:100%'>
	<%= form_tag nil, method: :get do %>
		
		<div class='form-group'>
			
			<%= label_tag :name_query, "Name", class: 'col-sm-2' %>
			<div class='col-sm-8'>
				<%= text_field_tag :name_query, params[:name_query], class: 'form-control' %>
			</div>
		</div>
	
		<div class='form-group'>
			<%= label_tag :delta_notation_query, "Delta Notation", class: 'col-sm-2' %>
			<div class='col-sm-8'>
				<%= text_field_tag :delta_notation_query, params[:delta_notation_query], class: 'form-control' %>
			</div>
		</div>
		
		<div class='form-group'>
			<div class='col-sm-2'>
				<%= label_tag :mass, "Mass Range" %>
			</div>
			<div class='col-sm-10 form-inline'>
				Min
				<%= number_field_tag :mass_min, params[:mass_min], class: 'form-control' %>
				Max
				<%= number_field_tag :mass_max, params[:mass_max], class: 'form-control'%>
			</div>
		</div>
		
		<%= submit_tag "Search", class: "btn btn-info"%>
		<%= link_to "Clear Query", fatty_acids_path, class: 'btn btn-warning pull-right' %>
	<% end %>
</div>

<div class='panel table-responsive'>
	
	<div class="panel-heading clearfix">
		<div class='pull-right'><%= page_entries_info @fatty_acids %></div>
		<div class='pull-left' style="margin-right:1em">Filters:</div>
		<%= left_dropdown_select "data", :has_data, [['Has data points','true'],['No data points','false']] %>
		<%= left_dropdown_select "category", :category, @categories.map{|c| [c,c]} %>
	</div>
	
  <table class='table table-striped table-centered'>
    <thead>
      <tr>
				<th style="width:300px">Structure</th>
				<th><%= sortable 'name','Systematic Name' %></th>
				<th style='white-space:nowrap'>Other Names</th>
				<th><%= sortable 'Formula' %></th>
				<th><%= sortable 'Mass' %></th>
				<th><%= sortable 'delta_notation', 'âˆ† Notation' %></th>
				<th><%= sortable 'sofa_mol_id', 'SOFA ID'%></th>
        <th><%= sortable 'result_count', 'Data Points'%></th>
				<th>Phylo Tree</th>
      </tr>
    </thead>

    <tbody>
      <% @fatty_acids.each do |fatty_acid| %>
        <tr>
					<td>
						<% if fatty_acid.image_link %>
							<%= link_to image_tag(fatty_acid.image_link), fatty_acid %>
						<% else %>
							<%= link_to image_tag("http://opsin.ch.cam.ac.uk/opsin/#{fatty_acid.name}.png"), fatty_acid if fatty_acid.name %>
						<% end %>
					</td>
					<td><%= link_to fatty_acid.name, fatty_acid if fatty_acid.name%></td>
					<td><%= truncate("#{[fatty_acid.common_name,fatty_acid.other_names].compact.join('; ')}",{length: 150}) %></td>
					<td style='white-space:nowrap'><%= fatty_acid.formula %></td>
					<td><%= fatty_acid.mass %></td>
          <td><%= fatty_acid.delta_notation %></td>
					<td><%= fatty_acid.sofa_mol_id %></td>
          <td><%= link_to fatty_acid.result_count, results_path(measure_id: fatty_acid.id) if fatty_acid.result_count %></td>
        	<td><%= link_to "Tree", tree_index_path(measure_id: fatty_acid.id) if fatty_acid.result_count %></td>
				</tr>
      <% end %>
    </tbody>
  </table>
</div>

<% content_for :footer do -%>
<% end -%>